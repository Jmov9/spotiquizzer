<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SpotiQuizzer</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <main id="wrapper">

    <!-- Takaisin-nappi + otsikko -->
    <div id="game-header" style="display: none;">
      <button id="back-button" onclick="goToMenu()">←</button>
      <h2 id="view-title">Guess the song?</h2>
    </div>

    <!-- Pelin aloitusnäkymä -->
    <div id="setup">
      <h2>Valitse pelitila</h2>

      <button id="solo-btn" onclick="selectMode('solo')">Solo</button>
      <button id="party-btn" onclick="selectMode('party')">Party</button>

      <div id="party-setup" style="display:none;">
        <h3>Syötä pelaajien nimet:</h3>
        <div id="player-inputs">
          <input type="text" placeholder="Pelaaja 1">
        </div>
        <button onclick="addPlayerInput()">Lisää pelaaja</button>
      </div>

      <h3>Kierrosten määrä: <span id="roundCountDisplay">5</span></h3>
      <input type="range" id="roundCountInput" min="1" max="10" value="5" />

      <button onclick="startSelectedMode()">Aloita peli</button>
    </div>

    <!-- Pelinäkymä -->
    <div id="game-container" style="display: none;">
      <img id="play-logo" src="spotiquiz.jpg" alt="Play" onclick="togglePlayPause()">
      <p id="play-instruction">Press the logo to play/pause</p>

      <audio id="audioPlayer"></audio>

      <div id="options"></div>
      <p id="current-player" style="font-weight: bold; font-size: 1.2em;"></p>
      <div id="result"></div>

      <button onclick="window.location.href='game.html'">Takaisin valintaan</button>
    </div>

    <!-- Lopputulos -->
    <div id="end-screen" style="display: none;">
      <h2>Game Over</h2>
      <div>
        <p id="winner">Winner:</p>
        <ul id="score-list"></ul>
      </div>

      <button onclick="location.reload()">New Game</button>
      <button onclick="goToMenu()">Quit Game</button>
    </div>
  </main>

  <script src="game.js"></script>
  <script>
    function goToMenu() {
      const token = new URLSearchParams(window.location.search).get('access_token') || localStorage.getItem('access_token');
      const base = 'index.html';
      window.location.href = token ? `${base}?access_token=${token}` : base;
    }

    // Näyttää otsikon + back-napin kun peli käynnistyy
    document.addEventListener('DOMContentLoaded', () => {
      const header = document.getElementById('game-header');
      const container = document.getElementById('game-container');
      const observer = new MutationObserver(() => {
        header.style.display = container.style.display === 'none' ? 'none' : 'flex';
      });
      observer.observe(container, { attributes: true, attributeFilter: ['style'] });
    });
  </script>
</body>
</html>
